<Window x:Class="ThreeQuestion.PureXamlWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:ThreeQuestion"
        mc:Ignorable="d"
        Title="Three Question Minute Repeater (Pure XAML)" Height="600" Width="600"
        Background="#222222"
        Loaded="Window_Loaded">
    
    <Window.Resources>
        <!-- No external resources needed, defining styles inline or dynamically -->
    </Window.Resources>

    <x:Code>
        <![CDATA[
        private System.Windows.Threading.DispatcherTimer _timer;
        private bool _isChiming = false;

        private void Window_Loaded(object sender, System.Windows.RoutedEventArgs e)
        {
            DrawTicks();
            DrawNumbers();
            StartClock();
        }

        private void DrawNumbers()
        {
            double radius = 155;
            double centerX = 200;
            double centerY = 200;

            for (int i = 1; i <= 12; i++)
            {
                System.Windows.Controls.TextBlock tb = new System.Windows.Controls.TextBlock();
                tb.Text = i.ToString();
                tb.FontSize = 24;
                tb.FontFamily = new System.Windows.Media.FontFamily("Times New Roman");
                tb.FontWeight = System.Windows.FontWeights.Bold;
                tb.Foreground = new System.Windows.Media.SolidColorBrush(System.Windows.Media.Color.FromRgb(212, 175, 55)); 
                
                tb.Effect = new System.Windows.Media.Effects.DropShadowEffect() 
                { 
                    Color = System.Windows.Media.Colors.Black, 
                    BlurRadius = 2, 
                    ShadowDepth = 1,
                    Opacity = 0.8
                };

                tb.Measure(new System.Windows.Size(double.PositiveInfinity, double.PositiveInfinity));
                double width = tb.DesiredSize.Width;
                double height = tb.DesiredSize.Height;

                double angleDeg = (i * 30) - 90;
                double angleRad = angleDeg * (System.Math.PI / 180.0);

                double x = centerX + radius * System.Math.Cos(angleRad) - (width / 2);
                double y = centerY + radius * System.Math.Sin(angleRad) - (height / 2);

                System.Windows.Controls.Canvas.SetLeft(tb, x);
                System.Windows.Controls.Canvas.SetTop(tb, y);
                NumbersCanvas.Children.Add(tb);
            }
        }

        private void DrawTicks()
        {
            for (int i = 0; i < 60; i++)
            {
                System.Windows.Shapes.Rectangle tick = new System.Windows.Shapes.Rectangle();
                if (i % 5 == 0)
                {
                    tick.Width = 4;
                    tick.Height = 12;
                    tick.Fill = new System.Windows.Media.SolidColorBrush(System.Windows.Media.Color.FromRgb(212, 175, 55)); 
                }
                else
                {
                    tick.Width = 1;
                    tick.Height = 6;
                    tick.Fill = new System.Windows.Media.SolidColorBrush(System.Windows.Media.Color.FromRgb(150, 150, 150)); 
                }

                System.Windows.Media.TransformGroup tg = new System.Windows.Media.TransformGroup();
                tg.Children.Add(new System.Windows.Media.TranslateTransform(-tick.Width / 2, -tick.Height / 2));
                tg.Children.Add(new System.Windows.Media.TranslateTransform(0, -180));
                tg.Children.Add(new System.Windows.Media.RotateTransform(i * 6));
                tg.Children.Add(new System.Windows.Media.TranslateTransform(200, 200));

                tick.RenderTransform = tg;
                TicksCanvas.Children.Add(tick);
            }
        }

        private void StartClock()
        {
            _timer = new System.Windows.Threading.DispatcherTimer();
            _timer.Interval = System.TimeSpan.FromSeconds(1);
            _timer.Tick += Timer_Tick;
            _timer.Start();
            UpdateHands(); 
        }

        private void Timer_Tick(object sender, System.EventArgs e)
        {
            UpdateHands();
        }

        private void UpdateHands()
        {
            System.DateTime now = System.DateTime.Now;

            double hourAngle = ((now.Hour % 12) + now.Minute / 60.0) * 30;
            HourHandTransform.Angle = hourAngle;

            double minuteAngle = (now.Minute + now.Second / 60.0) * 6;
            MinuteHandTransform.Angle = minuteAngle;

            double secondAngle = now.Second * 6;
            SecondHandTransform.Angle = secondAngle;
        }

        private async void OnMinuteRepeaterClick(object sender, System.Windows.RoutedEventArgs e)
        {
            if (_isChiming) return;
            _isChiming = true;
            StatusText.Text = "Listening...";

            try
            {
                await System.Threading.Tasks.Task.Run(() => PlayMinuteRepeater());
            }
            catch (System.Exception ex)
            {
                System.Windows.MessageBox.Show("Error: " + ex.Message);
            }
            finally
            {
                _isChiming = false;
                StatusText.Text = "Ready";
            }
        }

        private void PlayMinuteRepeater()
        {
            System.DateTime now = System.DateTime.Now;
            
            int hours = now.Hour % 12;
            if (hours == 0) hours = 12;

            int quarters = now.Minute / 15;

            int minutesPast = now.Minute % 15;

            UpdateStatusSafe("Hours: " + hours);
            for (int i = 0; i < hours; i++)
            {
                BeepLow();
                System.Threading.Thread.Sleep(600); 
            }

            if (quarters > 0 || minutesPast > 0) System.Threading.Thread.Sleep(800); 

            UpdateStatusSafe("Quarters: " + quarters);
            for (int i = 0; i < quarters; i++)
            {
                BeepHigh(); 
                System.Threading.Thread.Sleep(80); 
                BeepLow();  
                System.Threading.Thread.Sleep(500); 
            }

            if (minutesPast > 0) System.Threading.Thread.Sleep(800);

            UpdateStatusSafe("Minutes: " + minutesPast);
            for (int i = 0; i < minutesPast; i++)
            {
                BeepHigh();
                System.Threading.Thread.Sleep(300); 
            }
            
            UpdateStatusSafe("Done");
            System.Threading.Thread.Sleep(1000);
        }

        private void BeepLow()
        {
            if (System.Environment.OSVersion.Platform == System.PlatformID.Win32NT)
            {
                try { System.Console.Beep(300, 200); } catch { }
            }
        }

        private void BeepHigh()
        {
             if (System.Environment.OSVersion.Platform == System.PlatformID.Win32NT)
             {
                 try { System.Console.Beep(600, 150); } catch { }
             }
        }

        private void UpdateStatusSafe(string text)
        {
            Dispatcher.Invoke(() => StatusText.Text = text);
        }
        ]]>
    </x:Code>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Clock Face -->
        <Viewbox Grid.Row="0" Margin="20">
            <Grid Width="400" Height="400">
                <Grid.Effect>
                    <DropShadowEffect Color="Black" BlurRadius="20" ShadowDepth="10" Opacity="0.6"/>
                </Grid.Effect>

                <!-- 1. Bezel / Case (Outer Gold Ring) -->
                <Ellipse StrokeThickness="12">
                    <Ellipse.Stroke>
                        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                            <GradientStop Color="#FDB931" Offset="0.0"/>
                            <GradientStop Color="#9E7812" Offset="0.3"/>
                            <GradientStop Color="#FDB931" Offset="0.6"/>
                            <GradientStop Color="#F0E68C" Offset="0.8"/>
                            <GradientStop Color="#9E7812" Offset="1.0"/>
                        </LinearGradientBrush>
                    </Ellipse.Stroke>
                    <Ellipse.Fill>
                        <RadialGradientBrush GradientOrigin="0.5,0.5" Center="0.5,0.5" RadiusX="0.5" RadiusY="0.5">
                            <GradientStop Color="#2C2F33" Offset="0.0" />
                            <GradientStop Color="#1A1C1F" Offset="1.0" />
                        </RadialGradientBrush>
                    </Ellipse.Fill>
                </Ellipse>

                <!-- Decoration: Inner Gold Rim -->
                <Ellipse Margin="15" Stroke="#D4AF37" StrokeThickness="1"/>

                <!-- Numbers Container -->
                <Canvas x:Name="NumbersCanvas" Width="400" Height="400" />

                <!-- Ticks Container -->
                <Canvas x:Name="TicksCanvas" Width="400" Height="400" />

                <!-- Branding Text -->
                <TextBlock Text="MINUTE REPEATER" Foreground="#888" FontSize="10" FontFamily="Times New Roman" 
                           HorizontalAlignment="Center" VerticalAlignment="Top" Margin="0,110,0,0" />

                <!-- Hour Hand (Fancy Shape) -->
                <Path x:Name="HourHand" Fill="#D4AF37" Stroke="Black" StrokeThickness="0.5"
                      Data="M -4,0 L -3,-60 L 0,-70 L 3,-60 L 4,0 L 0,10 Z"
                      RenderTransformOrigin="0.5, 0.5" HorizontalAlignment="Center" VerticalAlignment="Center">
                     <Path.RenderTransform>
                         <TransformGroup>
                            <TranslateTransform Y="-25" /> 
                            <RotateTransform x:Name="HourHandTransform" Angle="0"/>
                         </TransformGroup>
                    </Path.RenderTransform>
                    <Path.Effect>
                        <DropShadowEffect ShadowDepth="2" BlurRadius="2" Opacity="0.4"/>
                    </Path.Effect>
                </Path>

                <!-- Minute Hand (Fancy Shape) -->
                <Path x:Name="MinuteHand" Fill="#E0E0E0" Stroke="Black" StrokeThickness="0.5"
                      Data="M -3,0 L -2,-90 L 0,-100 L 2,-90 L 3,0 L 0,15 Z"
                      RenderTransformOrigin="0.5, 0.5" HorizontalAlignment="Center" VerticalAlignment="Center">
                    <Path.RenderTransform>
                        <TransformGroup>
                            <TranslateTransform Y="-35" />
                            <RotateTransform x:Name="MinuteHandTransform" Angle="0"/>
                        </TransformGroup>
                    </Path.RenderTransform>
                    <Path.Effect>
                        <DropShadowEffect ShadowDepth="3" BlurRadius="3" Opacity="0.4"/>
                    </Path.Effect>
                </Path>

                <!-- Second Hand -->
                <Grid x:Name="SecondHand" Width="10" Height="220" VerticalAlignment="Center" HorizontalAlignment="Center" RenderTransformOrigin="0.5, 0.5">
                     <Grid.RenderTransform>
                        <RotateTransform x:Name="SecondHandTransform" Angle="0"/>
                    </Grid.RenderTransform>

                    <Path Fill="#B22222" Data="M -0.5,40 L -0.5,-120 L 0.5,-120 L 0.5,40 Z" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                    <Ellipse Width="6" Height="6" Fill="#B22222" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0,0,0,160"/> 
                </Grid>

                <!-- Center Pin (Cap) -->
                <Ellipse Width="12" Height="12" Fill="Black" Stroke="#D4AF37" StrokeThickness="2" HorizontalAlignment="Center" VerticalAlignment="Center">
                     <Ellipse.Effect>
                        <DropShadowEffect ShadowDepth="1" BlurRadius="2"/>
                    </Ellipse.Effect>
                </Ellipse>
                
            </Grid>
        </Viewbox>

        <!-- Controls -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="20">
            <Button Content="Trigger Minute Repeater (三问报时)" 
                    Click="OnMinuteRepeaterClick" 
                    Padding="15,10" 
                    FontSize="16" 
                    Background="#D4AF37" 
                    Foreground="White"
                    FontWeight="Bold"
                    BorderThickness="0">
                <Button.Resources>
                    <Style TargetType="Border">
                        <Setter Property="CornerRadius" Value="5"/>
                    </Style>
                </Button.Resources>
            </Button>
            <TextBlock x:Name="StatusText" Text="" Foreground="White" VerticalAlignment="Center" Margin="15,0,0,0" FontSize="14"/>
        </StackPanel>
    </Grid>
</Window>
